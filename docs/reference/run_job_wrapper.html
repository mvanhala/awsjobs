<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Run R worker job — run_job_wrapper • awsjobs</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Run R worker job — run_job_wrapper" />

<meta property="og:description" content="This is a convenience function for running an R script or R Markdown document on
an EC2 worker instance. The user just has to provide the script/document to execute,
the desired memory and cpu, and whether to execute as a spot instance.
Other parameters are filled with defaults passed to run_job()." />





<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">awsjobs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mvanhala/awsjobs/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Run R worker job</h1>
    <small class="dont-index">Source: <a href='https://github.com/mvanhala/awsjobs/blob/master/R/run_job_wrapper.R'><code>R/run_job_wrapper.R</code></a></small>
    <div class="hidden name"><code>run_job_wrapper.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>This is a convenience function for running an R script or R Markdown document on
an EC2 worker instance. The user just has to provide the script/document to execute,
the desired memory and cpu, and whether to execute as a spot instance.
Other parameters are filled with defaults passed to <code><a href='run_job.html'>run_job()</a></code>.</p>
    
    </div>

    <pre class="usage"><span class='fu'>run_job_wrapper</span>(
  <span class='no'>script</span>,
  <span class='no'>memory</span>,
  <span class='no'>cpu</span>,
  <span class='no'>spot</span>,
  <span class='kw'>image_id</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.getenv.html'>Sys.getenv</a></span>(<span class='st'>"AWS_R_IMAGE"</span>),
  <span class='kw'>efs_name</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.getenv.html'>Sys.getenv</a></span>(<span class='st'>"AWS_R_EFS_ID"</span>),
  <span class='kw'>security_group_id</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.getenv.html'>Sys.getenv</a></span>(<span class='st'>"AWS_R_SECURITY_GROUP"</span>),
  <span class='kw'>ssm_iam_profile</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.getenv.html'>Sys.getenv</a></span>(<span class='st'>"AWS_R_SSM_PROFILE"</span>),
  <span class='kw'>efs_mnt_pt</span> <span class='kw'>=</span> <span class='st'>"/efs"</span>,
  <span class='kw'>region</span> <span class='kw'>=</span> <span class='st'>"us-west-2"</span>,
  <span class='kw'>instance_max_hours</span> <span class='kw'>=</span> <span class='fl'>24</span>,
  <span class='kw'>exec_timeout_hours</span> <span class='kw'>=</span> <span class='fl'>24</span>,
  <span class='kw'>r_version</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/numeric_version.html'>getRversion</a></span>()),
  <span class='kw'>ssm_work_dir</span> <span class='kw'>=</span> <span class='no'>efs_mnt_pt</span>,
  <span class='kw'>log_file</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>rmd_opts</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  <span class='kw'>job_name</span> <span class='kw'>=</span> <span class='no'>script</span>,
  <span class='kw'>job_run_dir</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/getwd.html'>getwd</a></span>()
)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>script</th>
      <td><p>Path to the R script or R Markdown document to execute (on EFS storage)</p></td>
    </tr>
    <tr>
      <th>memory</th>
      <td><p>Minimum memory (in GB) desired</p></td>
    </tr>
    <tr>
      <th>cpu</th>
      <td><p>Minimum number of CPU cores desired</p></td>
    </tr>
    <tr>
      <th>spot</th>
      <td><p>Logical, whether to run a spot instance</p></td>
    </tr>
    <tr>
      <th>image_id</th>
      <td><p>id of the AMI to launch</p></td>
    </tr>
    <tr>
      <th>efs_name</th>
      <td><p>EFS id</p></td>
    </tr>
    <tr>
      <th>security_group_id</th>
      <td><p>Security group id</p></td>
    </tr>
    <tr>
      <th>ssm_iam_profile</th>
      <td><p>Name of IAM profile with SSM permissions. This profile will be
attached to the launched EC2 instance.</p></td>
    </tr>
    <tr>
      <th>efs_mnt_pt</th>
      <td><p>Mount point of EFS storage on worker instance</p></td>
    </tr>
    <tr>
      <th>region</th>
      <td><p>AWS EC2 region</p></td>
    </tr>
    <tr>
      <th>instance_max_hours</th>
      <td><p>Maximum lifetime of the instance in hours before it will
automatically shut down</p></td>
    </tr>
    <tr>
      <th>exec_timeout_hours</th>
      <td><p>Number of hours for timeout of the SSM command for executing
the script</p></td>
    </tr>
    <tr>
      <th>r_version</th>
      <td><p>Version of R to use</p></td>
    </tr>
    <tr>
      <th>ssm_work_dir</th>
      <td><p>Working directory of SSM command for executing R script/document</p></td>
    </tr>
    <tr>
      <th>log_file</th>
      <td><p>Path of log file to which stdout/stderr of R script will be written</p></td>
    </tr>
    <tr>
      <th>rmd_opts</th>
      <td><p>If running an R Markdown document, optional parameters for the output file path
and document parameters</p></td>
    </tr>
    <tr>
      <th>job_name</th>
      <td><p>Name of the job</p></td>
    </tr>
    <tr>
      <th>job_run_dir</th>
      <td><p>Working directory for the RStudio Job that is launched (should not need to change)</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Some parameters, such as the image id, EFS id, security group id, and SSM IAM profile
to attach to the launched instance, are assumed to be stored in environment variables.
The user could put these in a configuration file or otherwise set these environment
variables, or simply override them in invoking the function.</p>
<p>The user specifies an amount of memory and CPU and whether to use a spot instance.
The function then determines the optimal spot (or on-demand) instance to use.</p>
<p>This function does not block the running R session. What it does is launch an
RStudio Job in a child process. Information about the running job is displayed in the
RStudio Jobs pane. However, note that the user should <em>not</em> user the stop button
to stop a running job. This will leave the running EC2 instance severed/orphaned and
it will keep running without any connection to the R process. Because the instance
has a maximum lifetime set when launched, the instance won't keep running forever, and
will shutdown when the maximum is reached (or the ordinary execution on the instances finishes).
Nonetheless, the user will instead want to call <code><a href='stop_job.html'>stop_job()</a></code>, providing the job id
printed in the RStudio Jobs pane to send an interrupt to the child R process which will
trigger the termination of the running EC2 worker instance.</p>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matthew Van Hala.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


